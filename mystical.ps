%!
(dmmlib/base.ps) run
(dmmlib/textbase.ps) run
(dmmlib/lines.ps) run

/code {
    /dot {currentlinewidth 1.5 mul 0 360 arc fill } def
    0 0 1 0 360 arc stroke
    0 0 0.5 180 360 arc
    0 0 0.375 360 180 arcn closepath
    fill
    2 {
        0.375 dup dot
        gsave
            0.375 dup translate
            5 {
                0 0 moveto 4 recip 0 lineto stroke
                45 rotate
            } repeat
        grestore
        -1 1 scale
    } repeat
} cvlit def

/nib_angle -30 def

/nstroke {
    gsave
        nib_angle rotate
        0.5 1 scale
        0.5 callistroke
    grestore
    newpath
} def

/sigil_bank <<
    /arc {
        0 0 0.5 -45 90 sparc 
        0 0 0.5 90 215 sparc 
        gsave currentpoint newpath dot grestore
        nstroke
        -0.5 0 goto 0.5 0 goto nstroke
    } 
    /arcn {
        -1 1 scale
        0 0 0.5 -45 90 sparc 
        0 0 0.5 90 215 sparc 
        gsave currentpoint newpath dot grestore
        nstroke
        -0.5 0 goto
        -0.125 dup goto
        0.125 dup goto
        0.5 0 goto nstroke
    } 
    /closepath {
        0 0 0.5 60 180 sparc
        0 0 0.5 180 -60 sparc
        0 0 goto
        % 0.5 0 0.5 240 180 sparcn
        % 0.5 0 0.5 180 120 sparcn
        closepath
        gsave currentpoint newpath dot grestore
        nstroke
        % doot
    } 
    /dup {
        gsave
            -0.125 0 translate
            -0.25 0.5 goto
            0 0 0.5 90 -90 arcn
            -0.25 -0.5 goto
            closepath nstroke
            0 0.5 goto 0 -0.5 goto nstroke
        grestore
    } 
    /fill {
        gsave
            2 recip softscale
            -0.75 -1 goto -0.75 1 goto 0.75 1 goto nstroke
            -0.75 0 goto 0.75 0 goto nstroke
            /step 0.25 def
            -0.75 step add step 0.75 step sub {
                0 goto 0 1 rgoto nstroke
            } for
        grestore
    }
    /stroke {
        0 0.25 goto
        0 0.25 0.25 90 -90 arc
        0 -0.25 0.25 90 -90 arcn
        nstroke
        0 -0.5 dot
    }
    /repeat {
        gsave
            3 {
                0.25 0 goto
                0.5 -0.5 goto
                nstroke
                -0.25 0 translate
            } repeat
        grestore
        -0.5 -0.5 goto
        -0.5 0.5 goto
        0.25 0.25 0.25 90 -90 sparcn
        -0.5 0 goto
        whitefill nstroke
    }
    /scale {
        6 recip softscale
        0 1 translate
        0 1 1 0 270 arc
        0 -2 2 90 -180 arcn nstroke
    }
    /def {
        0 0 0.5 spcircle nstroke
        3 {
            0 0.5 goto
        } circrepeat closepath nstroke
    }
>> def
/sigil { /capsule arg
    10 dict begin
    capsule 0 get 
    dup type cvlit /otype arg
    dup xcheck /xflag arg
    cvlit /in_token arg
    /skip_sigil false def
    otype /nametype eq {
        xflag not {
            gsave
                3 {
                    -0.75 0 goto
                } circrepeat closepath nstroke
            grestore
        } if
    } if
    otype /arraytype eq {
        /skip_sigil true def
        0 0 goto 5 0 lineto nstroke
        gsave
            5 0 translate
            180 rotate
            in_token mystical
        grestore
        xflag {
            0 0 0.125 spcircle whitefill nstroke
        } {
            doot
        } ifelse
    } if
    0.75 softscale
    90 rotate
    skip_sigil not {
        sigil_bank in_token known {
            gsave
                sigil_bank in_token get exec
            grestore
        } {
            in_token buffer cvs centershow
        } ifelse
    } if
    false {
        0 -0.75 translate
        2 recip softscale
        xflag {
            /Times-Bold 0.5 selectfont
        } if
        otype buffer cvs centershow
    } if
    end
} def
/mystical {
    10 dict begin
        /input_code arg
        /Times 0.5 selectfont
        /buffer 20 string def
        input_code length 1 add /circ arg
        /angle 360 circ div def
        /rad angle sin recip def
        0 0 rad 0.5 add circle whitefill nstroke
        0 0 rad 0.5 sub circle nstroke
        0 1 circ 1 sub { /i arg
            gsave
                angle i 1 add mul rotate
                rad 0 translate
                i circ 1 sub lt {
                    [input_code i get] sigil
                } {
                    4 { 0.5 0 goto } circrepeat closepath nstroke
                    0.5 0 goto 1 0 goto nstroke
                    0.75 -0.25 goto 0.75 0.25 goto nstroke
                } ifelse
            grestore
        } for
    end
} def

%%EndProlog
72 softscale
4.25 5.5 translate
-2 0 translate
3 recip softscale
code mystical
code cvx exec
showpage
